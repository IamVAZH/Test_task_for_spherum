# Бэкенд. Тестовое задание для студентов
>Пример запуска приложения:<br/>
```java -jar Library-1.0-SNAPSHOT.jar data.json log.json ```


## Дополнительный функционал
### GET /market
Добавлена возможность фильтрации по: <br/>
начальной цене - startPrice <br/>
конечной цене - endPrice <br/>
по начальной и конечной - startPrice,endPrice <br/>
по имени автора - author <br/>
по названию книги - name <br/>

### POST /market/refund
Добавлена возможность возврата книги в магазин за пол цены. 
С помощью этого эндпоинта происходит сделка между пользователем и магазином. В теле этого **POST** HTTP запроса отпраляется JSON с указанием книги(`Book`) и количества(`amount`) товара.
Сделка считается неудачной, если:
- Книга не найдена в списке книг аккаунта
- Количество купленных книг меньше того количества, которое мы передаем для продажи
- Книга продается(продавалась) в магазине

В случае успешной продажи ожидается ответ с HTTP статусом **200**, в ином случае **400**.

### POST /account/subscribe
Добавлена возможность подписки(покупки карт). 
  Карты дают возможность покупать книги до 2000р включительно, бесплатно<br/> 
  В приложении два вида карт: <br/>
  - стоит 3000 дает 5 шт 
  - стоит 6000 дает 12 шт
  - стоит 60000 дает 200 шт
В теле этого **POST** HTTP запроса передается JSON с указанием идентификатора(`id`) карточки <br/>
Сделка считается неудачной если:
- Нет карты с таким id 
- Не хватает денег для покупки абонимента <br/>
В случае успешной подписки ожидается ответ с HTTP статусом **200**, в ином случае **400**.

Данная возможность влияет на покупку книг. Приоритет отдается покупке по карте.
Теперь если на аккаунте есть подписка, сделка также считается успешной если:
- Цена книги более 2000 включая и кол-во книг для покупки(`subscriptionCount`) не менее желаемого кол-ва(`amount`)

### GET account/bookmarks
Добавлена возможность отображения избранных книг <br/>
Ожидается, что HTTP статус ответа всегда будет 200.

### POST account/bookmarks
Возможность добавления книги в список избранных книг.
При попытке добавить книгу, которая уже есть в списке возникает ошибка <br/>
В случае успешной сделки ожидается ответ с HTTP статусом **200**, в ином случае **400**.

### DELETE account/bookmarks
Возможность удаления книги из списка избранных книг.
При попытке удалить книгу, которой нет в списке возникает ошибка <br/>
В случае успешной сделки ожидается ответ с HTTP статусом **200**, в ином случае **400**.

## Основные требования
### GET /account
Используется для получения информации об аккаунте. Информация - это список купленных книг и количество оставшихся денег. 
Ожидается, что HTTP статус ответа всегда будет 200.
>Пример запроса:<br/>

```curl -X GET 'http://localhost:8080/account' -H 'Content-Type: application/json' ```<br/>
>Пример ответа:<br/>
```{
  "books": [
    {
      "book": {
        "name": "Думай медленно... Решай быстро",
        "author": "Даниэль Канеман"
      },
      "amount": 1
    },
    {
      "book": {
        "name": "Философия Java",
        "author": "Брюс Эккель"
      },
      "amount": 2
    }
  ],
  "balance": 30
}
```
### GET /market
Используется для получения информации о магазине. Здесь информация - это список товаров (книг в продаже) с количеством и ценой за 1 шт.
**Не нужно включать в ответ книги, которых не осталось в продаже (amount = 0).**
Ожидается, что HTTP статус ответа всегда будет 200.
>Пример запроса:<br/>

```curl -X GET 'localhost:8080/market' -H 'Content-Type: application/json' ```<br/>
>Пример ответа:<br/>

```{
  "products": [
    {
      "id": 0,
      "book": {
        "name": "Философия Java",
        "author": "Брюс Эккель"
      },
      "price": 100,
      "amount": 3
    },
    {
      "id": 1,
      "book": {
        "name": "Думай медленно... Решай быстро",
        "author": "Даниэль Канеман"
      },
      "price": 70,
      "amount": 2
    }
  ]
}
```
### POST /market/deal
С помощью этого эндпоинта происходит сделка между пользователем и магазином. В теле этого **POST** HTTP запроса отправляется JSON с указанием идентификатора (`id`) товара, который хочется купить в желаемом количестве (`amount`).
Сделка может быть как успешной, так и неуспешной. Неуспешная сделка, это когда:
- Книги с таким идентификатором нет в продаже
- Книги есть в продаже, но в недостаточном количестве
- У аккаунта не хватает денег, чтобы оплатить покупку
В случае успешной сделки ожидается ответ с HTTP статусом **200**, в ином случае **400**.<br/>
>Пример запроса:<br/>

``` 
curl -X POST 'http://localhost:8080/market/deal' \
-H 'Content-Type: application/json' \
-d '{"id": 0, "amount": 2}'
```

### Начальные данные:
>Содержимое data.json и testData.json:<br/>

```{
  "account": {
    "money": 20000
  },
  "books": [
    {
      "author": "Стив Макконелл",
      "name": "Совершенный код",
      "price": 1000,
      "amount": 7
    },
    {
      "author": "Брюс Эккель",
      "name": "Философия Java",
      "price": 1500,
      "amount": 15
    },
    {
      "author": "Joshua Bloch",
      "name": "Effective Java",
      "price": 2500,
      "amount": 10
    },
    {
      "author": "Sierra, Kathy, Bates, Bert",
      "name": "Head First Java",
      "price": 1250,
      "amount": 0
    }
  ]
}
```
